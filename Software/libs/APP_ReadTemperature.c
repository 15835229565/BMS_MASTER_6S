#include "BSW_ReadADC.h"
#include "APP_ReadTemperature.h"


// Tabela 16X overampling at 2K4 +100R and 5V
rom unsigned int T16bit[TABLE_LEN]={0x0C07,0x0C1B,0x0C2F,0x0C44,0x0C58,0x0C6C,0x0C81,0x0C96,0x0CAA,0x0CBF,0x0CD4,0x0CE9,0x0CFE,0x0D13,0x0D28,0x0D3D,0x0D53,0x0D68,0x0D7D,0x0D93,
                                    0x0DA8,0x0DBE,0x0DD3,0x0DE9,0x0DFF,0x0E14,0x0E2A,0x0E40,0x0E56,0x0E6C,0x0E82,0x0E98,0x0EAE,0x0EC4,0x0EDB,0x0EF1,0x0F07,0x0F1E,0x0F34,0x0F4A,
                                    0x0F61,0x0F77,0x0F8E,0x0FA5,0x0FBB,0x0FD2,0x0FE9,0x0FFF,0x1016,0x102D,0x1044,0x105B,0x1071,0x1088,0x109F,0x10B6,0x10CD,0x10E4,0x10FB,0x1113,
                                    0x112A,0x1141,0x1158,0x116F,0x1186,0x119E,0x11B5,0x11CC,0x11E3,0x11FB,0x1212,0x1229,0x1241,0x1258,0x126F,0x1287,0x129E,0x12B6,0x12CD,0x12E4,
                                    0x12FC,0x1313,0x132B,0x1342,0x135A,0x1371,0x1389,0x13A0,0x13B8,0x13CF,0x13E7,0x13FE,0x1416,0x142D,0x1445,0x145C,0x1474,0x148B,0x14A3,0x14BA,
                                    0x14D1,0x14E9,0x1500,0x1518,0x152F,0x1547,0x155E,0x1576,0x158D,0x15A5,0x15BC,0x15D3,0x15EB,0x1602,0x161A,0x1631,0x1648,0x1660,0x1677,0x168E,
                                    0x16A6,0x16BD,0x16D4,0x16EB,0x1703,0x171A,0x1731,0x1748,0x175F,0x1777,0x178E,0x17A5,0x17BC,0x17D3,0x17EA,0x1801,0x1818,0x182F,0x1846,0x185D,
                                    0x1874,0x188B,0x18A2,0x18B8,0x18CF,0x18E6,0x18FD,0x1914,0x192A,0x1941,0x1958,0x196E,0x1985,0x199B,0x19B2,0x19C9,0x19DF,0x19F5,0x1A0C,0x1A22,
                                    0x1A39,0x1A4F,0x1A65,0x1A7C,0x1A92,0x1AA8,0x1ABE,0x1AD5,0x1AEB,0x1B01,0x1B17,0x1B2D,0x1B43,0x1B59,0x1B6F,0x1B85,0x1B9B,0x1BB0,0x1BC6,0x1BDC,
                                    0x1BF2,0x1C07,0x1C1D,0x1C33,0x1C48,0x1C5E,0x1C73,0x1C89,0x1C9E,0x1CB4,0x1CC9,0x1CDE,0x1CF3,0x1D09,0x1D1E,0x1D33,0x1D48,0x1D5D,0x1D72,0x1D87};


unsigned char Temperature[ADC_ChanalNo];

signed int TdC(unsigned int tp_temp)    //Temperatura iz LOOK-up tabele
{
    signed int temp = -20;
    unsigned char cnt =1;
//    tp_temp = tp_temp >> 4;
    while ((T16bit[cnt] < tp_temp)&&(cnt < TABLE_LEN))
    {
        cnt++;
        temp++;
    }

    if (temp > -20)
    {
        temp = temp *10 +((tp_temp -T16bit[cnt -1])*10)/(T16bit[cnt] -T16bit[cnt -1]);
    }    
    else
    {
        temp = -999;
    }    
    return(temp);
}

unsigned char Temperatura(unsigned int tp_temp)    //Temperatura iz LOOK-up tabele
{
    unsigned char cnt =1;
    while ((T16bit[cnt] < tp_temp)&&(cnt < TABLE_LEN))
    {
        cnt++;
    }
    return(cnt);
}

void CalcTemps()
{
    unsigned char cnt;
    for(cnt=0; cnt<ADC_ChanalNo; cnt++)
    {
    	Temperature[cnt] = Temperatura(ADC_result[cnt]);
    } 

}
