#include "BSW_ReadADC.h"
#include "APP_ReadTemperature.h"


// Tabela 16X overampling at 2K4 +100R and 5V
/*rom unsigned int T16bit[TABLE_LEN]={0x0C07,0x0C1B,0x0C2F,0x0C44,0x0C58,0x0C6C,0x0C81,0x0C96,0x0CAA,0x0CBF,0x0CD4,0x0CE9,0x0CFE,0x0D13,0x0D28,0x0D3D,0x0D53,0x0D68,0x0D7D,0x0D93,
                                    0x0DA8,0x0DBE,0x0DD3,0x0DE9,0x0DFF,0x0E14,0x0E2A,0x0E40,0x0E56,0x0E6C,0x0E82,0x0E98,0x0EAE,0x0EC4,0x0EDB,0x0EF1,0x0F07,0x0F1E,0x0F34,0x0F4A,
                                    0x0F61,0x0F77,0x0F8E,0x0FA5,0x0FBB,0x0FD2,0x0FE9,0x0FFF,0x1016,0x102D,0x1044,0x105B,0x1071,0x1088,0x109F,0x10B6,0x10CD,0x10E4,0x10FB,0x1113,
                                    0x112A,0x1141,0x1158,0x116F,0x1186,0x119E,0x11B5,0x11CC,0x11E3,0x11FB,0x1212,0x1229,0x1241,0x1258,0x126F,0x1287,0x129E,0x12B6,0x12CD,0x12E4,
                                    0x12FC,0x1313,0x132B,0x1342,0x135A,0x1371,0x1389,0x13A0,0x13B8,0x13CF,0x13E7,0x13FE,0x1416,0x142D,0x1445,0x145C,0x1474,0x148B,0x14A3,0x14BA,
                                    0x14D1,0x14E9,0x1500,0x1518,0x152F,0x1547,0x155E,0x1576,0x158D,0x15A5,0x15BC,0x15D3,0x15EB,0x1602,0x161A,0x1631,0x1648,0x1660,0x1677,0x168E,
                                    0x16A6,0x16BD,0x16D4,0x16EB,0x1703,0x171A,0x1731,0x1748,0x175F,0x1777,0x178E,0x17A5,0x17BC,0x17D3,0x17EA,0x1801,0x1818,0x182F,0x1846,0x185D,
                                    0x1874,0x188B,0x18A2,0x18B8,0x18CF,0x18E6,0x18FD,0x1914,0x192A,0x1941,0x1958,0x196E,0x1985,0x199B,0x19B2,0x19C9,0x19DF,0x19F5,0x1A0C,0x1A22,
                                    0x1A39,0x1A4F,0x1A65,0x1A7C,0x1A92,0x1AA8,0x1ABE,0x1AD5,0x1AEB,0x1B01,0x1B17,0x1B2D,0x1B43,0x1B59,0x1B6F,0x1B85,0x1B9B,0x1BB0,0x1BC6,0x1BDC,
                                    0x1BF2,0x1C07,0x1C1D,0x1C33,0x1C48,0x1C5E,0x1C73,0x1C89,0x1C9E,0x1CB4,0x1CC9,0x1CDE,0x1CF3,0x1D09,0x1D1E,0x1D33,0x1D48,0x1D5D,0x1D72,0x1D87};*/

unsigned int T16bit[TABLE_LEN]={0x0D38,0x0D4E,0x0D63,0x0D79,0x0D8F,0x0DA5,0x0DBB,0x0DD1,0x0DE8,0x0DFE,0x0E14,0x0E2B,0x0E41,0x0E58,0x0E6E,0x0E85,0x0E9C,0x0EB2,0x0EC9,0x0EE0,
                                    0x0EF7,0x0F0E,0x0F25,0x0F3C,0x0F53,0x0F6A,0x0F82,0x0F99,0x0FB0,0x0FC8,0x0FDF,0x0FF7,0x100E,0x1026,0x103D,0x1055,0x106D,0x1084,0x109C,0x10B4,
                                    0x10CC,0x10E4,0x10FC,0x1114,0x112C,0x1144,0x115C,0x1174,0x118C,0x11A4,0x11BC,0x11D4,0x11EC,0x1205,0x121D,0x1235,0x124D,0x1266,0x127E,0x1296,
                                    0x12AF,0x12C7,0x12DF,0x12F8,0x1310,0x1329,0x1341,0x1359,0x1372,0x138A,0x13A3,0x13BB,0x13D4,0x13EC,0x1405,0x141D,0x1436,0x144E,0x1467,0x147F,
                                    0x1498,0x14B0,0x14C9,0x14E1,0x14FA,0x1512,0x152B,0x1543,0x155C,0x1574,0x158D,0x15A5,0x15BE,0x15D6,0x15EF,0x1607,0x1620,0x1638,0x1651,0x1669,
                                    0x1681,0x169A,0x16B2,0x16CB,0x16E3,0x16FB,0x1714,0x172C,0x1744,0x175C,0x1775,0x178D,0x17A5,0x17BD,0x17D5,0x17EE,0x1806,0x181E,0x1836,0x184E,
                                    0x1866,0x187E,0x1896,0x18AE,0x18C6,0x18DE,0x18F6,0x190E,0x1925,0x193D,0x1955,0x196D,0x1985,0x199C,0x19B4,0x19CC,0x19E3,0x19FB,0x1A12,0x1A2A,
                                    0x1A41,0x1A59,0x1A70,0x1A88,0x1A9F,0x1AB6,0x1ACE,0x1AE5,0x1AFC,0x1B13,0x1B2A,0x1B41,0x1B59,0x1B70,0x1B87,0x1B9E,0x1BB5,0x1BCB,0x1BE2,0x1BF9,
                                    0x1C10,0x1C27,0x1C3D,0x1C54,0x1C6B,0x1C81,0x1C98,0x1CAE,0x1CC5,0x1CDB,0x1CF2,0x1D08,0x1D1E,0x1D35,0x1D4B,0x1D61,0x1D77,0x1D8D,0x1DA3,0x1DB9,
                                    0x1DCF,0x1DE5,0x1DFB,0x1E11,0x1E27,0x1E3D,0x1E52,0x1E68,0x1E7E,0x1E93,0x1EA9,0x1EBE,0x1ED4,0x1EE9,0x1EFE,0x1F14,0x1F29,0x1F3E,0x1F53,0x1F69};


unsigned char Temperature[ADC_ChanalNo];

int TdC(unsigned int tp_temp)    //Temperatura iz LOOK-up tabele
{
    signed int temp = -50;
    unsigned char cnt =1;
//    tp_temp = tp_temp >> 4;
    while ((T16bit[cnt] < tp_temp)&&(cnt < TABLE_LEN))
    {
        cnt++;
        temp++;
    }
    if (temp > -20)
        temp = temp *10 +((tp_temp -T16bit[cnt -1])*10)/(T16bit[cnt] -T16bit[cnt -1]);
    else
        temp = -999;
    return(temp);
}

int TcPak(unsigned int tp_temp)    //Temperatura iz LOOK-up tabele
{
    signed int temp = -50;
    unsigned char cnt =1;
    while ((T16bit[cnt] < tp_temp)&&(cnt < TABLE_LEN))
    {
        cnt++;
        temp++;
    }
    return(temp);
}


unsigned char Temperatura(unsigned int tp_temp)    //Temperatura iz LOOK-up tabele
{
    unsigned char cnt =1;
    while ((T16bit[cnt] < tp_temp)&&(cnt < TABLE_LEN))
    {
        cnt++;
    }
    return(cnt);
}

void CalcTemps()
{
    unsigned char cnt;
    for(cnt=0; cnt<ADC_ChanalNo; cnt++)
    {
    	Temperature[cnt] = TdC(ADC_result[cnt]);
    } 

}
